import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.Z6aMusZW.js";import{B as d}from"./button.BWaXVklz.js";import{I as c}from"./input.DYfGnR1o.js";import{L as n}from"./label.ByuxEscq.js";import{T as U}from"./textarea.ntLCWltE.js";import{C as u,b as f,c as N,d as y,a as v}from"./card.CoMIDSCG.js";import{A as J,a as D}from"./alert.BWe5-cIC.js";import{S as w}from"./skeleton.B3vSOSjr.js";import{S as G,a as W,b as K,c as M,d as I}from"./select.C_1Jy99F.js";import{U as Q}from"./user.zdQziaxZ.js";import{C as b}from"./circle-check-big.C0mK4qk5.js";import{C as O}from"./circle-x.BXci9Ly8.js";import{L as C}from"./loader-circle.DAcaG-Yh.js";import{A as Y}from"./arrow-left.DTOvvTq7.js";import{C as Z}from"./circle-alert.DSB0BqUH.js";import{I as g}from"./info.COjwR0tB.js";import{S as ee}from"./save.BcFhAao1.js";import{X as se}from"./x.B_0Xwiyu.js";import"./utils.CDN07tui.js";import"./index.CO5Cc353.js";import"./index.EfZGvMir.js";import"./index.lnW5t9aA.js";import"./Combination.LMohFq6j.js";import"./index.D9ngwW3m.js";import"./chevron-up.BnPhcTyb.js";import"./createLucideIcon.DXTouTbc.js";import"./check.BilKxX2O.js";function Te({playerId:r}){const[B,S]=o.useState(!!r),[i,F]=o.useState(!1),[P,j]=o.useState(""),[R,E]=o.useState(!1),[_,z]=o.useState([]),[h,A]=o.useState(null),[p,T]=o.useState(!1),[t,l]=o.useState({firstName:"",lastName:"",height:"",weight:"",image:"",bio:"",teamId:"",position:"",jerseyNumber:"",stats:""});o.useEffect(()=>{if(H(),r)$();else{const s=new URLSearchParams(window.location.search).get("teamId");s&&l(m=>({...m,teamId:s}))}},[r]);const H=async()=>{try{const a=await fetch("/api/teams");if(!a.ok)throw new Error("Failed to fetch teams");const s=await a.json();z(s)}catch(a){console.error("Error fetching teams:",a)}},$=async()=>{try{S(!0);const a=await fetch(`/api/players/${r}`);if(!a.ok)throw new Error("Failed to fetch player");const s=await a.json();l({firstName:s.firstName||"",lastName:s.lastName||"",height:s.height||"",weight:s.weight||"",image:s.image||"",bio:s.bio||"",teamId:s.teamId||s.team?.id||"",position:s.position||"",jerseyNumber:s.jerseyNumber?.toString()||"",stats:s.stats?JSON.stringify(s.stats,null,2):""}),A(s.approved??!1)}catch(a){j(a.message||"Failed to load player")}finally{S(!1)}},q=async a=>{a.preventDefault(),F(!0),j(""),E(!1);try{const s=r?`/api/players/${r}`:"/api/players",m=r?"PUT":"POST";let x=null;if(t.stats.trim())try{x=JSON.parse(t.stats)}catch{throw new Error("Invalid JSON in stats field")}const V={firstName:t.firstName.trim(),lastName:t.lastName.trim(),height:t.height.trim()||void 0,weight:t.weight.trim()||void 0,image:t.image.trim()||void 0,bio:t.bio.trim()||void 0,teamId:t.teamId||void 0,position:t.position||void 0,jerseyNumber:t.jerseyNumber?parseInt(t.jerseyNumber):void 0,stats:x},L=await fetch(s,{method:m,headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(!L.ok){const X=await L.json();throw new Error(X.error||"Failed to save player")}E(!0),setTimeout(()=>{window.location.href="/admin/players"},1500)}catch(s){j(s.message||"Failed to save player")}finally{F(!1)}},k=async a=>{if(r){T(!0);try{const s=await fetch(`/api/players/${r}/approve`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({approved:a})});if(!s.ok){const x=await s.json().catch(()=>({error:"Failed to update approval status"}));throw new Error(x.error||"Failed to update approval status")}const m=await s.json();A(m.approved)}catch(s){alert("Error updating approval status: "+s.message)}finally{T(!1)}}};return B?e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{className:"h-12 w-full"}),e.jsx(w,{className:"h-64 w-full"}),e.jsx(w,{className:"h-12 w-full"})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4 pb-6 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h1",{className:"text-3xl font-heading font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"h-8 w-8"}),r?"Edit Player":"Create New Player"]}),r&&h!==null&&e.jsx("div",{className:"flex items-center gap-2",children:h?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-green-100 text-green-800 text-sm font-medium",children:[e.jsx(b,{className:"h-3 w-3"}),"Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-sm font-medium",children:[e.jsx(O,{className:"h-3 w-3"}),"Pending Approval"]})})]}),e.jsx("p",{className:"text-muted-foreground",children:r?"Update player details and information":"Add a new player to your organization"}),r&&h!==null&&e.jsx("div",{className:"flex items-center gap-2 mt-3",children:h?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>k(!1),disabled:p,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:p?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Reject Player"]})}):e.jsx(d,{size:"sm",onClick:()=>k(!0),disabled:p,className:"bg-green-500 hover:bg-green-600 text-white",children:p?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Approve Player"]})})})]}),e.jsx(d,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/players","data-astro-prefetch":!0,children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Back to List"]})})]}),P&&e.jsxs(J,{variant:"destructive",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs(D,{children:[e.jsx("strong",{children:"Error:"})," ",P]})]}),R&&e.jsxs(J,{className:"border-green-500 bg-green-50 text-green-900",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs(D,{children:[e.jsx("strong",{children:"Success!"})," Player saved successfully! Redirecting..."]})]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Basic Information"}),e.jsx(y,{children:"Enter the player's personal details"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"firstName",children:["First Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(c,{id:"firstName",type:"text",value:t.firstName,onChange:a=>l(s=>({...s,firstName:a.target.value})),required:!0,disabled:i,placeholder:"John"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"lastName",children:["Last Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(c,{id:"lastName",type:"text",value:t.lastName,onChange:a=>l(s=>({...s,lastName:a.target.value})),required:!0,disabled:i,placeholder:"Doe"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"height",children:"Height"}),e.jsx(c,{id:"height",type:"text",value:t.height,onChange:a=>l(s=>({...s,height:a.target.value})),disabled:i,placeholder:`6'2"`}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),`Enter height in feet and inches format (e.g., 6'2" or 5'10")`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"weight",children:"Weight"}),e.jsx(c,{id:"weight",type:"text",value:t.weight,onChange:a=>l(s=>({...s,weight:a.target.value})),disabled:i,placeholder:"84 kg"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Enter weight with unit (e.g., 84 kg or 185 lbs)"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"image",children:"Image URL"}),e.jsx(c,{id:"image",type:"url",value:t.image,onChange:a=>l(s=>({...s,image:a.target.value})),disabled:i,placeholder:"https://example.com/image.jpg"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"URL to the player's photo"]}),t.image&&e.jsx("div",{className:"mt-2 border rounded-lg overflow-hidden",children:e.jsx("img",{src:t.image,alt:"Preview",className:"w-full max-h-[300px] object-contain",onError:a=>{a.target.style.display="none"}})})]})]})]}),e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Team & Position"}),e.jsx(y,{children:"Team assignment and playing position"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"teamId",children:"Team"}),e.jsxs(G,{value:t.teamId||"__none",onValueChange:a=>l(s=>({...s,teamId:a==="__none"?"":a})),disabled:i,children:[e.jsx(W,{id:"teamId",children:e.jsx(K,{placeholder:"Select a team"})}),e.jsxs(M,{children:[e.jsx(I,{value:"__none",children:"No team"}),_.map(a=>e.jsx(I,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"position",children:"Position"}),e.jsx(c,{id:"position",type:"text",value:t.position,onChange:a=>l(s=>({...s,position:a.target.value})),disabled:i,placeholder:"e.g., Point Guard, Center"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"jerseyNumber",children:"Jersey Number"}),e.jsx(c,{id:"jerseyNumber",type:"number",value:t.jerseyNumber,onChange:a=>l(s=>({...s,jerseyNumber:a.target.value})),disabled:i,placeholder:"23",min:"0",max:"99"})]})]})]}),e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Biography & Stats"}),e.jsx(y,{children:"Player biography and statistics"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bio",children:"Bio"}),e.jsx(U,{id:"bio",rows:6,value:t.bio,onChange:a=>l(s=>({...s,bio:a.target.value})),disabled:i,placeholder:"Enter player's biography"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"stats",children:"Stats (JSON)"}),e.jsx(U,{id:"stats",rows:8,value:t.stats,onChange:a=>l(s=>({...s,stats:a.target.value})),disabled:i,placeholder:'{"points": 25.5, "rebounds": 8.2, "assists": 6.1}',className:"font-mono text-sm"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Enter player statistics as valid JSON format"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(d,{type:"submit",disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),r?"Update Player":"Create Player"]})}),e.jsx(d,{type:"button",variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/players","data-astro-prefetch":!0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Cancel"]})})]})]})]})}export{Te as default};
