import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.Z6aMusZW.js";import{c as N}from"./react.CQc-tfl9.js";import{r as b}from"./types.DS8deZaU.js";const $=N(s=>({activeTab:"All",setActiveTab:a=>s({activeTab:a})}));function A(s){if(!s||s.trim()==="")return"/images/placeholder-350x250.gif";const a=s.trim();return a.startsWith("http://")||a.startsWith("https://")||a.startsWith("/")?a:a.startsWith("wp-content/")||a.startsWith("images/")?`/${a}`:`/${a}`}function T(){const{activeTab:s,setActiveTab:a}=$(),[i,m]=o.useState([]),[c,h]=o.useState(!0),[n,g]=o.useState(null);o.useEffect(()=>{async function t(){try{h(!0),g(null);const r=s==="All"?"":`&category=${encodeURIComponent(s)}`,d=await fetch(`/api/news?limit=5${r}`);if(!d.ok)throw new Error(`Failed to fetch articles: ${d.status}`);const f=await d.json();m(f.slice(0,5))}catch(r){console.error("Error fetching latest articles:",r),g(r instanceof Error?r.message:"Failed to load articles"),m([])}finally{h(!1)}}t()},[s]);const l=o.useMemo(()=>i.map((t,r)=>{const d=t.publishedAt?new Date(t.publishedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),f=b[t.category]||t.category,x=t.content.includes("youtube")||t.content.includes("vimeo"),j=t.id.split("").reduce((w,y)=>w+y.charCodeAt(0),0)%1e4,v=A(t.image);return{id:j,title:t.title,date:d,category:f,image:v,excerpt:t.excerpt||"",url:`/news/${t.slug}`,commentsCount:t.commentsCount,format:x?"video":"standard",feature:t.feature||!1}}),[i]),p=["All","Interviews","Championships","Match report","Analysis"],u=(t,r)=>{r.preventDefault(),a(t)};return e.jsxs("div",{className:"stm-news-grid style_2 stm-media-tabs stm-news-tabs-wrapper",children:[e.jsxs("div",{className:"clearfix",children:[e.jsx("div",{className:"stm-title-left",children:e.jsx("h2",{className:"stm-main-title-unit",children:"Latest news"})}),e.jsx("div",{id:"media_tabs_nav",className:"stm-media-tabs-nav",children:e.jsx("ul",{className:"stm-list-duty heading-font",role:"tablist",children:p.map(t=>e.jsx("li",{className:s===t?"active":"",children:e.jsx("a",{href:`#${t}`,"aria-controls":t,role:"tab","data-toggle":"tab",onClick:r=>u(t,r),className:s===t?"active":"",id:`tab-${t.toLowerCase().replace(" ","-")}`,children:e.jsx("span",{children:t})})},t))})})]}),e.jsx("div",{className:"tab-content",children:p.map(t=>e.jsx("div",{role:"tabpanel",className:`tab-pane fade ${s===t?"in active":""}`,id:t,"aria-labelledby":`tab-${t.toLowerCase().replace(" ","-")}`,children:s===t&&e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"stm-latest-news-wrapp",style:{textAlign:"center",padding:"2rem"},children:e.jsx("p",{children:"Loading latest articles..."})}),n&&e.jsx("div",{className:"stm-latest-news-wrapp",style:{textAlign:"center",padding:"2rem",color:"#ef4444"},children:e.jsxs("p",{children:["Error: ",n]})}),!c&&!n&&l.length===0&&e.jsx("div",{className:"stm-latest-news-wrapp",style:{textAlign:"center",padding:"2rem"},children:e.jsx("p",{children:"No articles found in this category."})}),!c&&!n&&l.length>0&&e.jsx("div",{className:"stm-latest-news-wrapp",children:l.map((r,d)=>e.jsx(C,{item:r},`article-${i[d]?.id||d}`))})]})},t))})]})}function C({item:s}){const[a,i]=o.useState(!1),[m,c]=o.useState(s.image),[h,n]=o.useState(!0);o.useEffect(()=>{if(i(!1),n(!0),c(s.image),s.image){const l=new Image;l.onload=()=>{n(!1),i(!1)},l.onerror=()=>{console.warn("Image failed to load:",s.image),i(!0),n(!1),c("/images/placeholder-350x250.gif")},l.src=s.image}else n(!1),i(!0),c("/images/placeholder-350x250.gif")},[s.image]);const g=l=>{a||(console.warn("Image error event triggered for:",m),i(!0),n(!1),c("/images/placeholder-350x250.gif"),l.currentTarget.src="/images/placeholder-350x250.gif")};return e.jsx("div",{className:"stm-latest-news-single",children:e.jsxs("div",{className:`stm-single-post-loop post-${s.id} post type-post status-publish format-${s.format||"standard"} has-post-thumbnail hentry category-${s.category.toLowerCase()}`,children:[e.jsx("a",{href:s.url,title:s.title,children:e.jsxs("div",{className:`image ${s.format==="video"?"video":""}`,children:[h&&!a&&e.jsx("div",{style:{width:"350px",height:"250px",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{color:"#999",fontSize:"14px"},children:"Loading..."})}),e.jsx("img",{decoding:"async",width:"350",height:"250",src:m,className:"img-responsive wp-post-image",alt:s.title,style:{display:h&&!a?"none":"block"},onError:g,onLoad:()=>n(!1)})]})}),e.jsxs("div",{className:"stm-news-data-wrapp",children:[e.jsx("div",{className:"date heading-font clear",children:s.date}),e.jsx("div",{className:"title heading-font clear",children:e.jsx("a",{href:s.url,children:s.title})}),e.jsxs("div",{className:"post-meta normal_font clear",children:[e.jsxs("div",{className:"news-category",children:[e.jsx("i",{className:"fa fa-folder-o","aria-hidden":"true"}),s.category]}),e.jsx("div",{className:"comments-number",children:e.jsxs("a",{href:`${s.url}#comments`,children:[e.jsx("i",{className:"fa fa-comment-o","aria-hidden":"true"}),e.jsx("span",{children:s.commentsCount})]})})]})]})]})})}export{T as default};
