import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.Z6aMusZW.js";import{B as l}from"./button.BWaXVklz.js";import{C as c,d as m,a as L,b as B,c as U}from"./card.YuvTJRVG.js";import{B as g}from"./badge.DPtWg24B.js";import{A as z,a as G}from"./alert.BWe5-cIC.js";import{S as p}from"./skeleton.B3vSOSjr.js";import{L as Y}from"./label.ByuxEscq.js";import{S as _,a as V,b as q,c as J,d as i}from"./select.B__e_A2K.js";import{D as je,a as ue,b as ge,c as pe,d as Ne,e as ve}from"./dialog.BQ4jkKsC.js";import{A as be,a as we,b as Ae,c as Se,d as Ce,e as Te,f as ye,g as Ee}from"./alert-dialog.B78ENQVB.js";import{C as X}from"./circle-alert.DSB0BqUH.js";import{A as Re}from"./arrow-left.DTOvvTq7.js";import{S as C,M as Ie,P as Pe}from"./square-pen.CdCizJHo.js";import{S as De,P as h}from"./shield.DPFejS3v.js";import{C as K}from"./circle-check-big.C0mK4qk5.js";import{C as Q}from"./circle-x.BXci9Ly8.js";import{F as Fe}from"./file-text.CSp1dnUh.js";import{L as T}from"./loader-circle.DAcaG-Yh.js";import{U as W}from"./users.DbM1g3zt.js";import{U as Z}from"./user.zdQziaxZ.js";import{B as ee}from"./briefcase.Dy88TS9y.js";import{X as He}from"./x.B_0Xwiyu.js";import{I as Oe}from"./info.COjwR0tB.js";import"./utils.CDN07tui.js";import"./index.CO5Cc353.js";import"./index.EfZGvMir.js";import"./index.CTkzGMNT.js";import"./Combination.UCZQMOc2.js";import"./index.D9ngwW3m.js";import"./chevron-up.BnPhcTyb.js";import"./createLucideIcon.DXTouTbc.js";import"./check.BilKxX2O.js";import"./index.3gSTBhB8.js";import"./index.B8x0sxYY.js";function gs({teamId:y}){const[a,E]=r.useState(null),[se,R]=r.useState(!0),[I,P]=r.useState(""),[N,ae]=r.useState([]),[f,te]=r.useState([]),[re,D]=r.useState(!0),[le,o]=r.useState(!1),[ie,de]=r.useState([]),[x,v]=r.useState(""),[j,b]=r.useState("COACH"),[F,d]=r.useState(""),[n,H]=r.useState(!1),[w,A]=r.useState(null),[u,O]=r.useState(!1);r.useEffect(()=>{oe()},[y]),r.useEffect(()=>{a&&(S(),ne())},[a?.id]);const oe=async()=>{try{R(!0),P("");const s=await fetch(`/api/teams/${y}`);if(!s.ok)throw new Error("Failed to fetch team");const t=await s.json();E(t),ae(t.players||[])}catch(s){P(s.message||"Failed to load team")}finally{R(!1)}};r.useEffect(()=>{window.location.hash==="#staff"&&setTimeout(()=>{const s=document.querySelector("#staff");s&&(s.scrollIntoView({behavior:"smooth",block:"start"}),o(!0))},100)},[]);const S=async()=>{if(a)try{D(!0);const s=await fetch(`/api/teams/${a.id}/staff`);if(s.ok){const t=await s.json();te(t)}}catch(s){console.error("Error fetching team staff:",s)}finally{D(!1)}},ne=async()=>{try{const s=await fetch("/api/staff");if(s.ok){const t=await s.json();de(t)}}catch(s){console.error("Error fetching available staff:",s)}},ce=async()=>{if(a){if(!x||!j){d("Please select a staff member and role");return}H(!0),d("");try{const s=await fetch(`/api/teams/${a.id}/staff`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:x,role:j})});if(!s.ok){const t=await s.json().catch(()=>({error:"Failed to add staff"}));throw new Error(t.error||"Failed to add staff")}o(!1),v(""),b("COACH"),d(""),S()}catch(s){console.error("Error adding staff:",s),d(s.message||"Failed to add staff. Please try again.")}finally{H(!1)}}},me=async s=>{if(a)try{if(!(await fetch(`/api/teams/${a.id}/staff?teamStaffId=${s}`,{method:"DELETE"})).ok)throw new Error("Failed to remove staff");S(),A(null)}catch(t){alert("Error removing staff: "+t.message)}},k=async s=>{if(a){O(!0);try{const t=await fetch(`/api/teams/${a.id}/approve`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({approved:s})});if(!t.ok){const xe=await t.json().catch(()=>({error:"Failed to update approval status"}));throw new Error(xe.error||"Failed to update approval status")}const fe=await t.json();E({...a,approved:fe.approved})}catch(t){alert("Error updating approval status: "+t.message)}finally{O(!1)}}},$=s=>({COACH:"Coach",ASSISTANT_COACH:"Assistant Coach",MANAGER:"Manager",ASSISTANT_MANAGER:"Assistant Manager",PHYSIOTHERAPIST:"Physiotherapist",TRAINER:"Trainer",ANALYST:"Analyst",OTHER:"Other"})[s]||s,he=s=>({COACH:"#667eea",ASSISTANT_COACH:"#4facfe",MANAGER:"#f5576c",ASSISTANT_MANAGER:"#43e97b",PHYSIOTHERAPIST:"#fa709a",TRAINER:"#fee140",ANALYST:"#30cfd0",OTHER:"#64748b"})[s]||"#64748b",M=ie.filter(s=>!f.some(t=>t.staffId===s.id));return se?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsx(p,{className:"h-12 w-full"}),e.jsx(p,{className:"h-64 w-full"})]}):I||!a?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs(z,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(G,{children:I||"Team not found"})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 pb-6 border-b",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,className:"mb-2",children:e.jsxs("a",{href:"/admin/teams","data-astro-prefetch":!0,children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Back to Teams"]})}),e.jsx("h1",{className:"text-3xl font-heading font-semibold text-foreground",children:"Team Details"})]}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:`/admin/teams/${a.id}`,"data-astro-prefetch":!0,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Edit Team"]})})]}),e.jsx(c,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:a.logo?e.jsx("img",{src:a.logo,alt:a.name,className:"w-32 h-32 rounded-xl object-cover border-4 border-border"}):e.jsx("div",{className:"w-32 h-32 rounded-xl bg-muted flex items-center justify-center border-4 border-border",children:e.jsx(De,{className:"h-12 w-12 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsx("h2",{className:"text-4xl font-heading font-bold text-foreground",children:a.name}),e.jsx("div",{className:"flex items-center gap-2",children:a.approved?e.jsxs(g,{className:"bg-green-500 text-white",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Approved"]}):e.jsxs(g,{variant:"secondary",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Pending Approval"]})})]}),a.description&&e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(Fe,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 mt-1"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a.description})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:a.approved?e.jsx(l,{variant:"outline",size:"sm",onClick:()=>k(!1),disabled:u,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:u?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Reject Team"]})}):e.jsx(l,{size:"sm",onClick:()=>k(!0),disabled:u,className:"bg-green-500 hover:bg-green-600 text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Approve Team"]})})})]})]})})}),e.jsxs(c,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6"}),"Players (",N.length,")"]}),e.jsx(U,{children:"Players currently on this team"})]}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:`/admin/players/new?teamId=${a.id}`,"data-astro-prefetch":!0,children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add Player"]})})]})}),e.jsx(m,{children:N.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx(W,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No players yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add players to this team to get started"}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:`/admin/players/new?teamId=${a.id}`,"data-astro-prefetch":!0,children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add First Player"]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(s=>e.jsxs(c,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.image?e.jsx("div",{className:"w-full h-48 overflow-hidden bg-muted",children:e.jsx("img",{src:s.image,alt:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():"Unnamed Player",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-48 bg-muted flex items-center justify-center",children:e.jsx(Z,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs(m,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():"Unnamed Player"}),(s.height||s.weight)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[s.height&&e.jsx("span",{children:s.height}),s.height&&s.weight&&e.jsx("span",{children:"â€¢"}),s.weight&&e.jsx("span",{children:s.weight})]}),s.position&&e.jsx("div",{className:"mb-2",children:e.jsx(g,{variant:"secondary",children:s.position})}),s.jerseyNumber&&e.jsxs("div",{className:"text-sm text-muted-foreground font-semibold mb-2",children:["#",s.jerseyNumber]}),s.bio&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-4",children:s.bio.length>100?`${s.bio.substring(0,100)}...`:s.bio}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,className:"w-full",children:e.jsxs("a",{href:`/admin/players/${s.id}`,"data-astro-prefetch":!0,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Edit"]})})})]})]},s.id))})})]}),e.jsxs(c,{id:"staff",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-6 w-6"}),"Staff (",f.length,")"]}),e.jsx(U,{children:"Coaches, managers, and team staff"})]}),e.jsxs(l,{onClick:()=>o(!0),children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add Staff"]})]})}),e.jsx(m,{children:re?e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"h-64 w-full"}),e.jsx(p,{className:"h-64 w-full"})]}):f.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx(ee,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No staff assigned"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add staff members to this team to get started"}),e.jsxs(l,{onClick:()=>o(!0),children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add First Staff Member"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsxs(c,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.staff.image?e.jsx("div",{className:"w-full h-48 overflow-hidden bg-muted",children:e.jsx("img",{src:s.staff.image,alt:`${s.staff.firstName} ${s.staff.lastName}`,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-48 bg-muted flex items-center justify-center",children:e.jsx(Z,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs(m,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2",children:[s.staff.firstName," ",s.staff.lastName]}),e.jsx("div",{className:"mb-2",children:e.jsx(g,{style:{backgroundColor:he(s.role)},className:"text-white",children:$(s.role)})}),(s.staff.email||s.staff.phone)&&e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-muted-foreground mb-2",children:[s.staff.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("a",{href:`mailto:${s.staff.email}`,className:"hover:text-primary",children:s.staff.email})]}),s.staff.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("a",{href:`tel:${s.staff.phone}`,className:"hover:text-primary",children:s.staff.phone})]})]}),s.staff.bio&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-4",children:s.staff.bio.length>100?`${s.staff.bio.substring(0,100)}...`:s.staff.bio}),e.jsxs("div",{className:"pt-4 border-t flex gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,className:"flex-1",children:e.jsxs("a",{href:`/admin/staff/${s.staff.id}`,"data-astro-prefetch":!0,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Edit"]})}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex-1 text-destructive hover:text-destructive",onClick:()=>A(s.id),children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Remove"]})]})]})]},s.id))})})]}),e.jsx(je,{open:le,onOpenChange:o,children:e.jsxs(ue,{children:[e.jsxs(ge,{children:[e.jsx(pe,{children:"Add Staff to Team"}),e.jsx(Ne,{children:"Select a staff member and their role for this team."})]}),F&&e.jsxs(z,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs(G,{children:[e.jsx("strong",{children:"Error:"})," ",F]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:"staff-select",children:["Staff Member ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(_,{value:x,onValueChange:s=>{v(s),d("")},disabled:n,children:[e.jsx(V,{id:"staff-select",children:e.jsx(q,{placeholder:"Select a staff member"})}),e.jsx(J,{children:M.map(s=>e.jsxs(i,{value:s.id,children:[s.firstName," ",s.lastName," - ",$(s.role)]},s.id))})]}),M.length===0&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"No available staff members. ",e.jsx("a",{href:"/admin/staff/new",className:"text-primary hover:underline",children:"Create a new staff member"})," first."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:"role-select",children:["Role for this Team ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(_,{value:j,onValueChange:s=>{b(s),d("")},disabled:n,children:[e.jsx(V,{id:"role-select",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(i,{value:"COACH",children:"Coach"}),e.jsx(i,{value:"ASSISTANT_COACH",children:"Assistant Coach"}),e.jsx(i,{value:"MANAGER",children:"Manager"}),e.jsx(i,{value:"ASSISTANT_MANAGER",children:"Assistant Manager"}),e.jsx(i,{value:"PHYSIOTHERAPIST",children:"Physiotherapist"}),e.jsx(i,{value:"TRAINER",children:"Trainer"}),e.jsx(i,{value:"ANALYST",children:"Analyst"}),e.jsx(i,{value:"OTHER",children:"Other"})]})]})]})]}),e.jsxs(ve,{children:[e.jsx(l,{variant:"outline",onClick:()=>{o(!1),d(""),v(""),b("COACH")},disabled:n,children:"Cancel"}),e.jsx(l,{onClick:ce,disabled:!x||!j||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add Staff"]})})]})]})}),e.jsx(be,{open:w!==null,onOpenChange:s=>!s&&A(null),children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Se,{children:"Remove Staff Member"}),e.jsx(Ce,{children:"Are you sure you want to remove this staff member from the team? This action cannot be undone."})]}),e.jsxs(Te,{children:[e.jsx(ye,{children:"Cancel"}),e.jsx(Ee,{onClick:()=>w&&me(w),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})})]})}export{gs as default};
