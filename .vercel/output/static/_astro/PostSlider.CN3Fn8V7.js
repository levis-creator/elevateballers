import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.Z6aMusZW.js";import{c as _}from"./react.CQc-tfl9.js";import{r as S}from"./types.DS8deZaU.js";const j=_((r,d)=>({currentSlide:0,totalSlides:0,isAutoPlaying:!1,goToSlide:s=>{const{totalSlides:i}=d();s>=0&&s<i&&r({currentSlide:s})},nextSlide:()=>{const{currentSlide:s,totalSlides:i}=d();r({currentSlide:(s+1)%i})},prevSlide:()=>{const{currentSlide:s,totalSlides:i}=d();r({currentSlide:s===0?i-1:s-1})},setTotalSlides:s=>r({totalSlides:s}),toggleAutoPlay:()=>r(s=>({isAutoPlaying:!s.isAutoPlaying})),setAutoPlay:s=>r({isAutoPlaying:s})}));function A(){const{currentSlide:r,goToSlide:d,setTotalSlides:s}=j(),[i,f]=c.useState([]),[x,h]=c.useState(!0),[g,p]=c.useState(null);return c.useEffect(()=>{async function l(){try{h(!0),p(null);const t=await fetch("/api/news?featured=true");if(!t.ok){const n=await t.text();throw console.error("API Error Response:",n),new Error(`Failed to fetch featured articles: ${t.status} ${t.statusText}`)}const a=await t.json();console.log("Fetched featured articles:",a.length),a.length===0&&console.warn("No featured articles found. Make sure you have articles with feature=true and published=true in the database.");const v=a.slice(0,5).map(n=>{let o=n.excerpt||"";if(typeof window<"u"){const u=document.createElement("div");u.innerHTML=o,o=u.textContent||u.innerText||""}else o=o.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();return o.length>180&&(o=o.substring(0,180).trim()+"..."),{id:n.id,image:n.image||"/images/default-slide.jpg",category:S[n.category]||n.category,title:n.title,excerpt:o,url:`/news/${n.slug}`,shareUrl:`/news/${n.slug}`}});f(v)}catch(t){console.error("Error fetching featured articles:",t),p(t instanceof Error?t.message:"Failed to load featured articles"),f([])}finally{h(!1)}}l()},[]),c.useEffect(()=>{i.length>0&&s(i.length)},[i.length,s]),c.useEffect(()=>{if(i.length===0)return;document.querySelectorAll(".stm-slide").forEach((a,m)=>{m===r?a.classList.add("active"):a.classList.remove("active")}),document.querySelectorAll(".stm-post__slider__nav li").forEach((a,m)=>{m===r?a.classList.add("active"):a.classList.remove("active")})},[r,i.length]),x?e.jsx("div",{className:"stm-post__slider container",children:e.jsx("div",{className:"stm-post__slides",children:e.jsx("div",{className:"stm-slide active",children:e.jsx("div",{className:"stm-post__slider__data container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-7 col-sm-6",children:e.jsx("div",{className:"stm-slide__title heading-font",children:"Loading featured articles..."})})})})})})}):g?(console.error("PostSlider error:",g),null):i.length===0?null:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"stm-post__slider container",children:[e.jsx("div",{className:"stm-post__slides",children:i.map((l,t)=>e.jsxs("div",{className:`stm-slide ${t===r?"active":""}`,id:l.id,children:[e.jsx("div",{className:"stm-post__slider__image",style:{backgroundImage:`url(${l.image})`}}),e.jsx("div",{className:"stm-post__slider__data container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-7 col-sm-6",children:[e.jsx("span",{className:"stm-slide__category",children:l.category}),e.jsx("div",{className:"stm-slide__title heading-font",children:l.title}),e.jsx("div",{className:"stm-slide__excerpt",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.5",maxHeight:"4.5em"},children:l.excerpt}),e.jsxs("a",{href:l.url,className:"stm-slide__link heading-font",children:["Read more ",e.jsx("i",{className:"icon-mg-icon-arrow-italic"})]})]})})})]},l.id))}),e.jsx("ul",{className:"stm-post__slider__nav",children:i.map((l,t)=>e.jsx("li",{className:t===r?"active":"",children:e.jsx("a",{href:`#${l.id}`,onClick:a=>{a.preventDefault(),d(t)},children:l.title})},l.id))})]})})}export{A as default};
