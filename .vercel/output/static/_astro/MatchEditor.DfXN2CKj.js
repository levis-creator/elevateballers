import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.Z6aMusZW.js";import{g as Fe,a as Le,b as Pe,c as Ae,d as _e,e as De}from"./team-helpers.vPMKc0Vn.js";import{g as Oe,a as Me}from"./league-helpers.1oObcXhs.js";import{B as b}from"./button.BWaXVklz.js";import{I as k}from"./input.DYfGnR1o.js";import{L as j}from"./label.ByuxEscq.js";import{C as V,b as J,c as W,a as H,d as ae}from"./card.CoMIDSCG.js";import{A as ne,a as ie}from"./alert.BWe5-cIC.js";import{S as G}from"./skeleton.B3vSOSjr.js";import{B as ee}from"./badge.DPtWg24B.js";import{C as ke}from"./checkbox.D89wNvvK.js";import{S as L,a as P,b as A,c as _,d as p}from"./select.C_1Jy99F.js";import{A as fe,a as ye,b as Ne,c as ve,d as Ie,e as Se,f as be,g as Te}from"./alert-dialog.C2ChNjF4.js";import{U as le}from"./users.DbM1g3zt.js";import{P as we,S as de}from"./shield.DPFejS3v.js";import{C as oe}from"./circle-alert.DSB0BqUH.js";import{S as me,A as K,T as X,a as te,C as Re,b as he,R as Ue,c as $e}from"./trophy.D9FOkt9-.js";import{X as se}from"./x.B_0Xwiyu.js";import{T as qe}from"./textarea.ntLCWltE.js";import{C as ue}from"./circle.p2pi6svn.js";import{L as Ce}from"./loader-circle.DAcaG-Yh.js";import{S as xe}from"./separator.BcNt21XF.js";import{A as Ve}from"./arrow-left.DTOvvTq7.js";import{S as He}from"./save.BcFhAao1.js";import"./utils.CDN07tui.js";import"./index.CO5Cc353.js";import"./index.EfZGvMir.js";import"./index.lnW5t9aA.js";import"./index.D9ngwW3m.js";import"./index.DUJzU2eK.js";import"./check.BilKxX2O.js";import"./createLucideIcon.DXTouTbc.js";import"./Combination.LMohFq6j.js";import"./chevron-up.BnPhcTyb.js";import"./index.8pPTknrX.js";function Be(i){return i.seasonId||null}function Je({matchId:i,team1Id:S,team2Id:g,onPlayerAdded:c}){const[T,u]=n.useState([]),[x,f]=n.useState([]),[I,D]=n.useState([]),[w,R]=n.useState(!0),[C,O]=n.useState(""),[m,F]=n.useState(!1),[U,h]=n.useState(""),[N,v]=n.useState(null),[r,d]=n.useState({playerId:"",teamId:"",started:!1,position:"",jerseyNumber:"",minutesPlayed:""});n.useEffect(()=>{i&&(M(),Y())},[i]),n.useEffect(()=>{r.teamId&&z(r.teamId)},[r.teamId]);const M=async()=>{try{R(!0);const a=await fetch(`/api/matches/${i}/players`);if(!a.ok)throw new Error("Failed to fetch match players");const s=await a.json();u(s)}catch(a){O(a.message||"Failed to load match players")}finally{R(!1)}},Y=async()=>{try{const a=await fetch("/api/teams");if(a.ok){const s=await a.json();if(D(s),s.length>0&&!U){const t=S||g||s[0].id;h(t),d(l=>({...l,teamId:t}))}}}catch(a){console.error("Failed to fetch teams:",a)}},z=async a=>{try{const s=await fetch(`/api/players?teamId=${a}`);if(s.ok){const t=await s.json();f(t)}}catch(s){console.error("Failed to fetch players:",s)}},B=async a=>{a.preventDefault(),O("");try{const s=await fetch(`/api/matches/${i}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,jerseyNumber:r.jerseyNumber?parseInt(r.jerseyNumber):void 0,minutesPlayed:r.minutesPlayed?parseInt(r.minutesPlayed):void 0})});if(!s.ok){const t=await s.json();throw new Error(t.error||"Failed to add player")}F(!1),d({playerId:"",teamId:r.teamId,started:!1,position:"",jerseyNumber:"",minutesPlayed:""}),M(),c&&c()}catch(s){O(s.message||"Failed to add player")}},Z=async a=>{try{if(!(await fetch(`/api/matches/${i}/players/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to remove player");M(),c&&c(),v(null)}catch(s){O(s.message||"Failed to remove player")}},$=a=>T.filter(s=>s.teamId===a),Q=a=>I.find(t=>t.id===a)?.name||"Unknown Team";return w?e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{className:"h-12 w-full"}),e.jsx(G,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-heading font-semibold flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Match Players"]}),e.jsxs(b,{size:"sm",onClick:()=>F(!m),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Player"]})]}),C&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ie,{children:C})]}),m&&e.jsxs(V,{children:[e.jsx(J,{children:e.jsx(W,{children:"Add Player to Match"})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"teamId",children:["Team ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:r.teamId,onValueChange:a=>{d(s=>({...s,teamId:a,playerId:""})),h(a)},required:!0,children:[e.jsx(P,{id:"teamId",children:e.jsx(A,{placeholder:"Select a team"})}),e.jsx(_,{children:I.map(a=>e.jsx(p,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"playerId",children:["Player ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:r.playerId,onValueChange:a=>d(s=>({...s,playerId:a})),required:!0,disabled:!r.teamId,children:[e.jsx(P,{id:"playerId",children:e.jsx(A,{placeholder:"Select a player"})}),e.jsx(_,{children:x.map(a=>e.jsxs(p,{value:a.id,children:[a.firstName," ",a.lastName,a.jerseyNumber?` (#${a.jerseyNumber})`:""]},a.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"position",children:"Position"}),e.jsx(k,{id:"position",type:"text",value:r.position,onChange:a=>d(s=>({...s,position:a.target.value})),placeholder:"e.g., Forward"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"jerseyNumber",children:"Jersey #"}),e.jsx(k,{id:"jerseyNumber",type:"number",value:r.jerseyNumber,onChange:a=>d(s=>({...s,jerseyNumber:a.target.value})),min:"0",max:"99"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"minutesPlayed",children:"Minutes"}),e.jsx(k,{id:"minutesPlayed",type:"number",value:r.minutesPlayed,onChange:a=>d(s=>({...s,minutesPlayed:a.target.value})),min:"0",max:"120"})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{id:"started",checked:r.started,onCheckedChange:a=>d(s=>({...s,started:a===!0}))}),e.jsx(j,{htmlFor:"started",className:"cursor-pointer",children:"Started"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"submit",children:"Add Player"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>F(!1),children:"Cancel"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[S&&e.jsxs(V,{children:[e.jsx(J,{children:e.jsx(W,{children:Q(S)})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[$(S).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("strong",{children:[a.player.firstName," ",a.player.lastName]}),a.jerseyNumber&&e.jsxs(ee,{variant:"secondary",className:"gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),a.jerseyNumber]}),a.started&&e.jsx(ee,{variant:"default",children:"Started"}),a.position&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",a.position,")"]}),a.minutesPlayed!==null&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.minutesPlayed,"'"]})]}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>v(a.id),children:e.jsx(se,{className:"h-4 w-4"})})]},a.id)),$(S).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No players added"})]})})]}),g&&e.jsxs(V,{children:[e.jsx(J,{children:e.jsx(W,{children:Q(g)})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[$(g).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("strong",{children:[a.player.firstName," ",a.player.lastName]}),a.jerseyNumber&&e.jsxs(ee,{variant:"secondary",className:"gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),a.jerseyNumber]}),a.started&&e.jsx(ee,{variant:"default",children:"Started"}),a.position&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",a.position,")"]}),a.minutesPlayed!==null&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.minutesPlayed,"'"]})]}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>v(a.id),children:e.jsx(se,{className:"h-4 w-4"})})]},a.id)),$(g).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No players added"})]})})]})]}),e.jsx(fe,{open:N!==null,onOpenChange:a=>!a&&v(null),children:e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Remove Player"}),e.jsx(Ie,{children:"Are you sure you want to remove this player from the match? This action cannot be undone."})]}),e.jsxs(Se,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Te,{onClick:()=>N&&Z(N),children:"Remove"})]})]})})]})}const re=[{value:"TWO_POINT_MADE",label:"2-Point Made",icon:X},{value:"TWO_POINT_MISSED",label:"2-Point Missed",icon:X},{value:"THREE_POINT_MADE",label:"3-Point Made",icon:X},{value:"THREE_POINT_MISSED",label:"3-Point Missed",icon:X},{value:"FREE_THROW_MADE",label:"Free Throw Made",icon:X},{value:"FREE_THROW_MISSED",label:"Free Throw Missed",icon:X},{value:"ASSIST",label:"Assist",icon:K},{value:"REBOUND_OFFENSIVE",label:"Offensive Rebound",icon:ue},{value:"REBOUND_DEFENSIVE",label:"Defensive Rebound",icon:ue},{value:"STEAL",label:"Steal",icon:de},{value:"BLOCK",label:"Block",icon:de},{value:"TURNOVER",label:"Turnover",icon:K},{value:"FOUL_PERSONAL",label:"Personal Foul",icon:te},{value:"FOUL_TECHNICAL",label:"Technical Foul",icon:te},{value:"FOUL_FLAGRANT",label:"Flagrant Foul",icon:te},{value:"SUBSTITUTION_IN",label:"Substitution In",icon:le},{value:"SUBSTITUTION_OUT",label:"Substitution Out",icon:le},{value:"TIMEOUT",label:"Timeout",icon:Re},{value:"INJURY",label:"Injury",icon:K},{value:"OTHER",label:"Other",icon:K}];function We({matchId:i,team1Id:S,team2Id:g}){const[c,T]=n.useState([]),[u,x]=n.useState([]),[f,I]=n.useState([]),[D,w]=n.useState(!0),[R,C]=n.useState(""),[O,m]=n.useState(!1),[F,U]=n.useState(null),[h,N]=n.useState({eventType:"TWO_POINT_MADE",minute:"",teamId:"",playerId:"",assistPlayerId:"",description:""});n.useEffect(()=>{i&&(v(),r())},[i]),n.useEffect(()=>{h.teamId&&d(h.teamId)},[h.teamId]);const v=async()=>{try{w(!0);const a=await fetch(`/api/matches/${i}/events`);if(!a.ok)throw new Error("Failed to fetch match events");const s=await a.json();T(s)}catch(a){C(a.message||"Failed to load match events")}finally{w(!1)}},r=async()=>{try{const a=await fetch("/api/teams");if(a.ok){const s=await a.json();if(I(s),s.length>0&&!h.teamId){const t=S||g||s[0].id;N(l=>({...l,teamId:t}))}}}catch(a){console.error("Failed to fetch teams:",a)}},d=async a=>{try{const s=await fetch(`/api/players?teamId=${a}`);if(s.ok){const t=await s.json();x(t)}}catch(s){console.error("Failed to fetch players:",s)}},M=async a=>{a.preventDefault(),C("");try{const s=await fetch(`/api/matches/${i}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,minute:parseInt(h.minute),playerId:h.playerId||void 0,assistPlayerId:h.assistPlayerId||void 0})});if(!s.ok){const t=await s.json();throw new Error(t.error||"Failed to add event")}m(!1),N({eventType:"TWO_POINT_MADE",minute:"",teamId:h.teamId,playerId:"",assistPlayerId:"",description:""}),v()}catch(s){C(s.message||"Failed to add event")}},Y=async a=>{try{if(!(await fetch(`/api/matches/${i}/events/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete event");v(),U(null)}catch(s){C(s.message||"Failed to delete event")}},z=a=>re.find(t=>t.value===a)?.icon||K,B=a=>re.find(t=>t.value===a)?.label||a,Z=a=>f.find(t=>t.id===a)?.name||"Unknown Team",$=a=>!["TIMEOUT"].includes(a),Q=a=>["TWO_POINT_MADE","THREE_POINT_MADE"].includes(a);return D?e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{className:"h-12 w-full"}),e.jsx(G,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-heading font-semibold flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Match Events"]}),e.jsxs(b,{size:"sm",onClick:()=>m(!O),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Event"]})]}),R&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ie,{children:R})]}),O&&e.jsxs(V,{children:[e.jsx(J,{children:e.jsx(W,{children:"Add Match Event"})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"eventType",children:["Event Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:h.eventType,onValueChange:a=>N(s=>({...s,eventType:a,assistPlayerId:""})),required:!0,children:[e.jsx(P,{id:"eventType",children:e.jsx(A,{})}),e.jsx(_,{children:re.map(a=>e.jsx(p,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"minute",children:["Minute ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(k,{id:"minute",type:"number",value:h.minute,onChange:a=>N(s=>({...s,minute:a.target.value})),required:!0,min:"0",max:"120",placeholder:"23"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"teamId",children:["Team ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:h.teamId,onValueChange:a=>{N(s=>({...s,teamId:a,playerId:"",assistPlayerId:""}))},required:!0,children:[e.jsx(P,{id:"teamId",children:e.jsx(A,{placeholder:"Select a team"})}),e.jsx(_,{children:f.map(a=>e.jsx(p,{value:a.id,children:a.name},a.id))})]})]}),$(h.eventType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"playerId",children:"Player"}),e.jsxs(L,{value:h.playerId,onValueChange:a=>N(s=>({...s,playerId:a})),disabled:!h.teamId,children:[e.jsx(P,{id:"playerId",children:e.jsx(A,{placeholder:"Select a player"})}),e.jsx(_,{children:u.map(a=>e.jsxs(p,{value:a.id,children:[a.firstName," ",a.lastName]},a.id))})]})]})]}),Q(h.eventType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"assistPlayerId",children:"Assist Player"}),e.jsxs(L,{value:h.assistPlayerId||"__none",onValueChange:a=>N(s=>({...s,assistPlayerId:a==="__none"?"":a})),disabled:!h.teamId,children:[e.jsx(P,{id:"assistPlayerId",children:e.jsx(A,{placeholder:"No assist"})}),e.jsxs(_,{children:[e.jsx(p,{value:"__none",children:"No assist"}),u.map(a=>e.jsxs(p,{value:a.id,children:[a.firstName," ",a.lastName]},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"description",children:"Description"}),e.jsx(qe,{id:"description",rows:2,value:h.description,onChange:a=>N(s=>({...s,description:a.target.value})),placeholder:"Additional details about the event..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"submit",children:"Add Event"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})})]}),e.jsx(V,{children:e.jsx(H,{className:"pt-6",children:c.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No events recorded yet"}):e.jsx("div",{className:"space-y-2",children:c.map(a=>{const s=z(a.eventType);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:[B(a.eventType)," - ",a.minute,"'"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Z(a.teamId),a.player&&e.jsxs(e.Fragment,{children:[" • ",a.player.firstName," ",a.player.lastName]}),a.assistPlayer&&e.jsxs(e.Fragment,{children:[" (Assist: ",a.assistPlayer.firstName," ",a.assistPlayer.lastName,")"]}),a.description&&e.jsxs(e.Fragment,{children:[" • ",a.description]})]})]})]}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>U(a.id),children:e.jsx(se,{className:"h-4 w-4"})})]},a.id)})})})}),e.jsx(fe,{open:F!==null,onOpenChange:a=>!a&&U(null),children:e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Delete Event"}),e.jsx(Ie,{children:"Are you sure you want to delete this event? This action cannot be undone."})]}),e.jsxs(Se,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Te,{onClick:()=>F&&Y(F),children:"Delete"})]})]})})]})}function je({id:i,label:S,value:g,teams:c,loading:T,saving:u,error:x,onSelect:f,customName:I,customLogo:D,onCustomNameChange:w,onCustomLogoChange:R}){const C=n.useMemo(()=>c.find(m=>m.id===g),[c,g]),O=C?C.name:"";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:i,children:[S," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:g||"__custom",onValueChange:m=>f(m==="__custom"?"":m),disabled:u||T,children:[e.jsx(P,{id:i,className:"flex items-center gap-2",children:e.jsx(A,{placeholder:T?"Loading teams...":c.length>0?"Select a team from database...":"No teams available - enter custom",children:O})}),e.jsxs(_,{children:[e.jsx(p,{value:"__custom",children:"Custom Team"}),c.length===0&&!T&&e.jsx(p,{value:"__empty",disabled:!0,children:"No teams in database"}),c.map(m=>e.jsx(p,{value:m.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.logo&&e.jsx("img",{src:m.logo,alt:m.name,className:"w-5 h-5 object-contain rounded",onError:F=>{F.currentTarget.style.display="none"}}),e.jsx("span",{children:m.name})]})},m.id))]})]}),!g&&e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsx(k,{id:`${i}Name`,type:"text",placeholder:`${S} Name`,value:I,onChange:m=>w(m.target.value),required:!g,disabled:u}),e.jsx(k,{id:`${i}Logo`,type:"url",placeholder:`${S} Logo URL`,value:D,onChange:m=>R(m.target.value),disabled:u})]}),T&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Ce,{className:"h-3 w-3 animate-spin"}),"Loading teams from database..."]}),!T&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.length>0?`${c.length} team${c.length!==1?"s":""} available from database`:"No teams in database. You can enter a custom team name or create a team first."}),x&&x.includes("teams")&&e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:"⚠️ Unable to load teams from database. You can still enter custom team names below."})]})}const Ge=["UPCOMING","LIVE","COMPLETED"],Ye=["REGULAR_SEASON","PRESEASON","EXHIBITION","PLAYOFF","QUARTER_FINALS","SEMI_FINALS","CHAMPIONSHIP","QUALIFIER","OTHER"],ce=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),pe=ce?console.log:()=>{},q=ce?console.error:()=>{},ge=ce?console.warn:()=>{};function Ps({matchId:i}){const[S,g]=n.useState(!!i),[c,T]=n.useState(!1),[u,x]=n.useState({teams:"",leagues:"",match:"",save:""}),[f,I]=n.useState([]),[D,w]=n.useState(!0),[R,C]=n.useState([]),[O,m]=n.useState(!1),[F,U]=n.useState([]),[h,N]=n.useState(!1),v=n.useRef(null),[r,d]=n.useState({team1Id:"",team1Name:"",team1Logo:"",team2Id:"",team2Name:"",team2Logo:"",leagueId:"",league:"",seasonId:"",date:"",team1Score:"",team2Score:"",status:"UPCOMING",stage:""}),M=n.useCallback(async s=>{try{N(!0);const t=await fetch(`/api/seasons?leagueId=${s}`);if(t.ok){const l=await t.json();U(l)}}catch(t){q("Failed to fetch seasons:",t)}finally{N(!1)}},[]),Y=n.useCallback(async()=>{if(i)try{g(!0),x(o=>({...o,match:""}));const s=await fetch(`/api/matches/${i}`);if(!s.ok)throw new Error("Failed to fetch match");const t=await s.json(),l=Oe(t)||"",y=Be(t)||"";d({team1Id:De(t)||"",team1Name:_e(t),team1Logo:Ae(t)||"",team2Id:Pe(t)||"",team2Name:Le(t),team2Logo:Fe(t)||"",leagueId:l,league:Me(t),seasonId:y,date:new Date(t.date).toISOString().slice(0,16),team1Score:t.team1Score?.toString()||"",team2Score:t.team2Score?.toString()||"",status:t.status,stage:t.stage||""}),l&&M(l)}catch(s){const t=s instanceof Error?s.message:"Failed to load match";x(l=>({...l,match:t}))}finally{g(!1)}},[i,M]),z=n.useCallback(async()=>{try{m(!0),x(t=>({...t,leagues:""}));const s=await fetch("/api/leagues");if(s.ok){const t=await s.json();C(t)}else x(t=>({...t,leagues:`Failed to load leagues (${s.status})`}))}catch(s){q("Failed to fetch leagues:",s);const t=s instanceof Error?s.message:"Unknown error";x(l=>({...l,leagues:`Failed to load leagues: ${t}`}))}finally{m(!1)}},[]),B=n.useCallback(async()=>{try{w(!0),x(o=>({...o,teams:""})),pe("[Client] Fetching teams from /api/teams..."),v.current&&v.current.abort();const s=new AbortController;v.current=s;const t=setTimeout(()=>{ge("[Client] Request timeout - aborting..."),s.abort()},8e3);let l;try{l=await fetch("/api/teams",{signal:s.signal,method:"GET",headers:{Accept:"application/json"},cache:"no-cache"}),clearTimeout(t)}catch(o){if(clearTimeout(t),o instanceof Error&&o.name==="AbortError"){q("[Client] Request timeout"),x(E=>({...E,teams:"Request timeout: The server is taking too long to respond. You can still enter custom team names."})),I([]),w(!1);return}throw o}if(!l.ok){let o;try{const E=await l.text();o=JSON.parse(E)}catch{o={error:`HTTP ${l.status}: ${l.statusText}`}}q("[Client] API request failed:",l.status,o),x(E=>({...E,teams:o.error||`Failed to load teams (${l.status})`})),I([]),w(!1);return}let y;try{const o=await l.text();y=JSON.parse(o)}catch(o){q("[Client] Failed to parse JSON response:",o),x(E=>({...E,teams:"Failed to parse server response. Check console for details."})),I([]),w(!1);return}if(Array.isArray(y))I(y),pe(`[Client] Successfully loaded ${y.length} teams from database`),y.length===0&&ge("[Client] No teams found in database");else if(y&&typeof y=="object"&&"error"in y){const o=y;q("[Client] API returned error:",o.error),x(E=>({...E,teams:`Failed to load teams: ${o.error}`})),I([])}else q("[Client] Unexpected response format:",y),x(o=>({...o,teams:"Failed to load teams: Unexpected response format"})),I([])}catch(s){q("[Client] Exception in fetchTeams:",s);const t=s instanceof Error?s.message:"Unknown error";x(l=>({...l,teams:`Failed to load teams: ${t}. You can still enter custom team names.`})),I([])}finally{w(!1),v.current=null}},[]);n.useEffect(()=>(B(),z(),i&&Y(),()=>{v.current&&v.current.abort()}),[i,B,z,Y]),n.useEffect(()=>{r.leagueId?M(r.leagueId):(U([]),d(s=>({...s,seasonId:""})))},[r.leagueId,M]);const Z=n.useMemo(()=>r.team2Id?f.filter(s=>s.id!==r.team2Id):f,[f,r.team2Id]),$=n.useMemo(()=>r.team1Id?f.filter(s=>s.id!==r.team1Id):f,[f,r.team1Id]),Q=()=>{const s=[];if(!r.team1Id&&!r.team1Name?.trim()&&s.push("Team 1 is required"),!r.team2Id&&!r.team2Name?.trim()&&s.push("Team 2 is required"),!r.leagueId&&!r.league?.trim()&&s.push("League is required"),r.date?new Date(r.date)<new Date&&r.status==="UPCOMING"&&s.push("Upcoming matches must be scheduled in the future"):s.push("Date & Time is required"),r.team1Score){const t=Number.parseInt(r.team1Score,10);(isNaN(t)||t<0||t>999)&&s.push("Team 1 score must be between 0 and 999")}if(r.team2Score){const t=Number.parseInt(r.team2Score,10);(isNaN(t)||t<0||t>999)&&s.push("Team 2 score must be between 0 and 999")}if(r.team1Logo&&!r.team1Id)try{new URL(r.team1Logo)}catch{s.push("Team 1 logo must be a valid URL")}if(r.team2Logo&&!r.team2Id)try{new URL(r.team2Logo)}catch{s.push("Team 2 logo must be a valid URL")}return s},a=async s=>{s.preventDefault(),T(!0),x({teams:"",leagues:"",match:"",save:""});try{const t=Q();if(t.length>0)throw new Error(t.join(". "));const l=i?`/api/matches/${i}`:"/api/matches",y=i?"PUT":"POST",o={date:r.date,status:r.status,stage:r.stage||null,team1Score:r.team1Score?Number.parseInt(r.team1Score,10):null,team2Score:r.team2Score?Number.parseInt(r.team2Score,10):null};r.leagueId?o.leagueId=r.leagueId:o.league=r.league,r.seasonId&&(o.seasonId=r.seasonId),r.team1Id?o.team1Id=r.team1Id:(o.team1Name=r.team1Name,o.team1Logo=r.team1Logo||""),r.team2Id?o.team2Id=r.team2Id:(o.team2Name=r.team2Name,o.team2Logo=r.team2Logo||"");const E=await fetch(l,{method:y,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!E.ok){const Ee=await E.json();throw new Error(Ee.error||"Failed to save match")}window.location.href="/admin/matches"}catch(t){const l=t instanceof Error?t.message:"Failed to save match";x(y=>({...y,save:l}))}finally{T(!1)}};return S?e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{className:"h-12 w-full"}),e.jsx(G,{className:"h-64 w-full"}),e.jsx(G,{className:"h-12 w-full"})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4 pb-6 border-b",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-heading font-semibold mb-2 text-foreground flex items-center gap-2",children:[e.jsx(he,{className:"h-8 w-8"}),i?"Edit Match":"Create New Match"]}),e.jsx("p",{className:"text-muted-foreground",children:i?"Update match details and information":"Create a new match fixture"})]}),e.jsx(b,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/matches","data-astro-prefetch":!0,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Back to List"]})})]}),(u.teams||u.leagues||u.match||u.save)&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs(ie,{children:[u.save||u.match||u.leagues||u.teams,u.teams&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("p",{children:"Please check:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Database connection is active"}),e.jsx("li",{children:"Teams exist in the database"}),e.jsx("li",{children:"Check browser console for detailed error logs"})]})]})]})]}),e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs(V,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Teams"}),e.jsx(ae,{children:"Select teams or enter custom team information"})]}),!D&&(f.length===0||u.teams)&&e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:B,disabled:D,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Retry"]})]})}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(je,{id:"team1Id",label:"Team 1",value:r.team1Id,teams:Z,loading:D,saving:c,error:u.teams,onSelect:s=>{const t=f.find(l=>l.id===s);d(l=>({...l,team1Id:s,team1Name:t?t.name:l.team1Name,team1Logo:t?t.logo||"":l.team1Logo,...l.team2Id===s?{team2Id:"",team2Name:"",team2Logo:""}:{}}))},customName:r.team1Name,customLogo:r.team1Logo,onCustomNameChange:s=>d(t=>({...t,team1Name:s})),onCustomLogoChange:s=>d(t=>({...t,team1Logo:s}))}),e.jsx(je,{id:"team2Id",label:"Team 2",value:r.team2Id,teams:$,loading:D,saving:c,error:u.teams,onSelect:s=>{const t=f.find(l=>l.id===s);d(l=>({...l,team2Id:s,team2Name:t?t.name:l.team2Name,team2Logo:t?t.logo||"":l.team2Logo,...l.team1Id===s?{team1Id:"",team1Name:"",team1Logo:""}:{}}))},customName:r.team2Name,customLogo:r.team2Logo,onCustomNameChange:s=>d(t=>({...t,team2Name:s})),onCustomLogoChange:s=>d(t=>({...t,team2Logo:s}))})]})})]}),e.jsxs(V,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Match Details"}),e.jsx(ae,{children:"Date, league, season, and stage"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"date",children:[e.jsx($e,{className:"inline h-4 w-4 mr-2"}),"Date & Time ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(k,{id:"date",type:"datetime-local",value:r.date,onChange:s=>d(t=>({...t,date:s.target.value})),required:!0,disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"leagueId",children:[e.jsx(he,{className:"inline h-4 w-4 mr-2"}),"League ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(L,{value:r.leagueId||"__custom",onValueChange:s=>{d(t=>({...t,leagueId:s==="__custom"?"":s,league:"",seasonId:""}))},required:!0,disabled:c,children:[e.jsx(P,{id:"leagueId",children:e.jsx(A,{placeholder:"Select a league or enter custom..."})}),e.jsxs(_,{children:[e.jsx(p,{value:"__custom",children:"Custom League"}),R.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))]})]}),!r.leagueId&&e.jsx(k,{id:"league",type:"text",placeholder:"League Name",value:r.league,onChange:s=>d(t=>({...t,league:s.target.value})),required:!r.leagueId,disabled:c,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"seasonId",children:"Season"}),e.jsxs(L,{value:r.seasonId||"__none",onValueChange:s=>d(t=>({...t,seasonId:s==="__none"?"":s})),disabled:c||!r.leagueId,children:[e.jsx(P,{id:"seasonId",children:e.jsx(A,{placeholder:r.leagueId?"Select a season":"Select a league first"})}),e.jsxs(_,{children:[e.jsx(p,{value:"__none",children:"No Season"}),F.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))]})]}),!r.leagueId&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a league first to choose a season"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"stage",children:"Match Stage"}),e.jsxs(L,{value:r.stage||"__none",onValueChange:s=>d(t=>({...t,stage:(s==="__none"?"":s)||""})),disabled:c,children:[e.jsx(P,{id:"stage",children:e.jsx(A,{placeholder:"Select stage (optional)"})}),e.jsxs(_,{children:[e.jsx(p,{value:"__none",children:"Regular Match"}),Ye.map(s=>e.jsx(p,{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},s))]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the stage or round of the match"})]})]})]})]}),e.jsxs(V,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Scores & Status"}),e.jsx(ae,{children:"Match scores and current status"})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"team1Score",children:"Team 1 Score"}),e.jsx(k,{id:"team1Score",type:"number",value:r.team1Score,onChange:s=>d(t=>({...t,team1Score:s.target.value})),min:"0",disabled:c,placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"team2Score",children:"Team 2 Score"}),e.jsx(k,{id:"team2Score",type:"number",value:r.team2Score,onChange:s=>d(t=>({...t,team2Score:s.target.value})),min:"0",disabled:c,placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"status",children:"Status"}),e.jsxs(L,{value:r.status,onValueChange:s=>d(t=>({...t,status:s})),disabled:c,children:[e.jsx(P,{id:"status",children:e.jsx(A,{})}),e.jsx(_,{children:Ge.map(s=>e.jsx(p,{value:s,children:s},s))})]})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(b,{type:"submit",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),i?"Update Match":"Create Match"]})}),e.jsx(b,{type:"button",variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/matches","data-astro-prefetch":!0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Cancel"]})})]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"my-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Je,{matchId:i,team1Id:r.team1Id||null,team2Id:r.team2Id||null}),e.jsx(xe,{className:"my-6"}),e.jsx(We,{matchId:i,team1Id:r.team1Id||null,team2Id:r.team2Id||null})]})]})]})}export{Ps as default};
