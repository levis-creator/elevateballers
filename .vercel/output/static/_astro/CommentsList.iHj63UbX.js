import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.Z6aMusZW.js";import{M as B,T as W}from"./trash-2.GrLsMpmQ.js";import{C as F}from"./circle-check-big.C0mK4qk5.js";import{C as A}from"./circle-x.BXci9Ly8.js";import{C as D,a as $}from"./chevron-up.BnPhcTyb.js";import"./createLucideIcon.DXTouTbc.js";function E({articleId:o,parentId:a,parentAuthorName:d,onSubmitted:c,onCancel:m}){const[s,h]=p.useState({content:"",authorName:"",authorEmail:"",authorUrl:""}),[g,x]=p.useState(!1),[y,b]=p.useState(null),[w,j]=p.useState(!1),n=async r=>{r.preventDefault(),x(!0),b(null),j(!1);try{const l=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s.content.trim(),authorName:s.authorName.trim()||void 0,authorEmail:s.authorEmail.trim()||void 0,authorUrl:s.authorUrl.trim()||void 0,articleId:o,parentId:a||void 0})});if(!l.ok){const S=await l.json();throw new Error(S.error||"Failed to submit comment")}h({content:"",authorName:"",authorEmail:"",authorUrl:""}),j(!0),c&&setTimeout(()=>{c()},1500)}catch(l){console.error("Error submitting comment:",l),b(l instanceof Error?l.message:"Failed to submit comment")}finally{x(!1)}},u=r=>{const{name:l,value:S}=r.target;h(C=>({...C,[l]:S}))};return w?e.jsx("div",{style:{padding:"1rem 1.25rem",background:"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)",color:"#065f46",borderRadius:"8px",marginBottom:"1rem",border:"1px solid #6ee7b7"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("p",{style:{margin:0,fontWeight:"500"},children:"Thank you! Your comment has been posted."})]})}):e.jsxs("div",{style:{background:a?"#f9fafb":"transparent",borderRadius:"12px",padding:a?"1.25rem":"0",border:a?"1px solid #e5e7eb":"none",marginTop:a?"1rem":"0"},children:[a&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",paddingBottom:"1rem",borderBottom:"1px solid #e5e7eb"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:"#111827"},children:["Reply to ",e.jsx("span",{style:{color:"#4f46e5"},children:d||"comment"})]}),m&&e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),m()},style:{background:"none",border:"none",color:"#6b7280",cursor:"pointer",fontSize:"14px",padding:"0.375rem 0.75rem",borderRadius:"6px",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.375rem",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="#f3f4f6",r.currentTarget.style.color="#374151"},onMouseLeave:r=>{r.currentTarget.style.background="none",r.currentTarget.style.color="#6b7280"},children:"Cancel"})]}),e.jsxs("form",{onSubmit:n,children:[y&&e.jsx("div",{style:{padding:"0.875rem 1rem",background:"#fef2f2",color:"#991b1b",borderRadius:"8px",marginBottom:"1rem",border:"1px solid #fecaca",fontSize:"14px"},children:y}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("textarea",{placeholder:"Write your comment...",name:"content",id:"comment-content",value:s.content,onChange:u,required:!0,rows:4,"aria-required":"true",style:{width:"100%",padding:"0.875rem 1rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"15px",fontFamily:"inherit",lineHeight:"1.5",resize:"vertical",transition:"all 0.2s",boxSizing:"border-box"},onFocus:r=>{r.currentTarget.style.borderColor="#4f46e5",r.currentTarget.style.outline="none",r.currentTarget.style.boxShadow="0 0 0 3px rgba(79, 70, 229, 0.1)"},onBlur:r=>{r.currentTarget.style.borderColor="#d1d5db",r.currentTarget.style.boxShadow="none"}})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx("div",{children:e.jsx("input",{placeholder:"Name (optional)",name:"authorName",type:"text",id:"comment-name",value:s.authorName,onChange:u,"aria-required":"false",style:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",transition:"all 0.2s",boxSizing:"border-box"},onFocus:r=>{r.currentTarget.style.borderColor="#4f46e5",r.currentTarget.style.outline="none",r.currentTarget.style.boxShadow="0 0 0 3px rgba(79, 70, 229, 0.1)"},onBlur:r=>{r.currentTarget.style.borderColor="#d1d5db",r.currentTarget.style.boxShadow="none"}})}),e.jsx("div",{children:e.jsx("input",{placeholder:"Email (optional)",name:"authorEmail",type:"email",id:"comment-email",value:s.authorEmail,onChange:u,"aria-required":"false",style:{width:"100%",padding:"0.75rem 1rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",transition:"all 0.2s",boxSizing:"border-box"},onFocus:r=>{r.currentTarget.style.borderColor="#4f46e5",r.currentTarget.style.outline="none",r.currentTarget.style.boxShadow="0 0 0 3px rgba(79, 70, 229, 0.1)"},onBlur:r=>{r.currentTarget.style.borderColor="#d1d5db",r.currentTarget.style.boxShadow="none"}})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.75rem"},children:[a&&m&&e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),m()},style:{padding:"0.75rem 1.5rem",background:"white",color:"#6b7280",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"15px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="#f9fafb",r.currentTarget.style.borderColor="#9ca3af"},onMouseLeave:r=>{r.currentTarget.style.background="white",r.currentTarget.style.borderColor="#d1d5db"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,style:{padding:"0.75rem 1.5rem",background:g?"#9ca3af":"#4f46e5",color:"white",border:"none",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:r=>{g||(r.currentTarget.style.background="#4338ca",r.currentTarget.style.transform="translateY(-1px)",r.currentTarget.style.boxShadow="0 4px 12px rgba(79, 70, 229, 0.4)")},onMouseLeave:r=>{g||(r.currentTarget.style.background="#4f46e5",r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="none")},children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin",style:{width:"16px",height:"16px"},viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Posting..."]}):"Post Comment"})]})]})]})}function L({comment:o,onReply:a,replyToId:d,depth:c=0,admin:m=!1,onUpdated:s,articleId:h,maxDepth:g=4}){const[x,y]=p.useState(!1),b=o.replies&&o.replies.length>0,w=d===o.id,j=c<g,[n,u]=p.useState(!1),r=t=>{const T=typeof t=="string"?new Date(t):t,k=new Date().getTime()-T.getTime(),z=Math.floor(k/6e4),N=Math.floor(k/36e5),M=Math.floor(k/864e5);return z<1?"Just now":z<60?`${z}m ago`:N<24?`${N}h ago`:M<7?`${M}d ago`:T.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},l=o.user?.name||o.authorName||"Anonymous",S=o.user?.email||o.authorEmail,C=async()=>{if(!(!m||n)){u(!0);try{if((await fetch(`/api/comments/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"approve"})})).ok&&s)s();else throw new Error("Failed to approve comment")}catch(t){console.error("Error approving comment:",t),alert("Failed to approve comment")}finally{u(!1)}}},i=async()=>{if(!(!m||n)){u(!0);try{if((await fetch(`/api/comments/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:"reject"})})).ok&&s)s();else throw new Error("Failed to reject comment")}catch(t){console.error("Error rejecting comment:",t),alert("Failed to reject comment")}finally{u(!1)}}},f=async()=>{if(!(!m||n)&&confirm("Are you sure you want to delete this comment? This action cannot be undone.")){u(!0);try{if((await fetch(`/api/comments/${o.id}`,{method:"DELETE",credentials:"include"})).ok&&s)s();else throw new Error("Failed to delete comment")}catch(t){console.error("Error deleting comment:",t),alert("Failed to delete comment")}finally{u(!1)}}},v=()=>S?`https://secure.gravatar.com/avatar/${S.toLowerCase().trim()}?s=48&d=mp&r=g`:"https://secure.gravatar.com/avatar/?s=48&d=mp&r=g";return e.jsxs("article",{id:`div-comment-${o.id}`,className:"comment-item",style:{marginBottom:c>0?"1rem":"1.5rem",marginLeft:c>0?"2rem":"0",paddingLeft:c>0?"1rem":"0",borderLeft:c>0?"2px solid #e5e7eb":"none",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"flex-start"},children:[e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{alt:l,src:v(),className:"comment-avatar",height:"48",width:"48",decoding:"async",style:{borderRadius:"50%",width:"48px",height:"48px",objectFit:"cover",border:"2px solid #f3f4f6"}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("strong",{style:{fontSize:"15px",fontWeight:"600",color:"#111827",lineHeight:"1.4"},children:l}),o.user&&e.jsx("span",{style:{fontSize:"12px",color:"#10b981",fontWeight:"500",padding:"0.125rem 0.375rem",background:"#d1fae5",borderRadius:"4px"},children:"Verified"}),e.jsx("time",{style:{fontSize:"13px",color:"#6b7280",fontWeight:"400"},children:r(o.createdAt)})]}),e.jsx("div",{style:{marginBottom:"0.75rem",fontSize:"15px",lineHeight:"1.6",color:"#374151",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:o.content}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[a&&j&&e.jsxs("button",{type:"button",onClick:t=>{t.preventDefault(),w?a(null,""):a(o.id,l)},className:"comment-reply-button",style:{background:"transparent",backgroundColor:"transparent",border:"none",color:w?"#ef4444":"#4f46e5",cursor:"pointer",fontSize:"14px",fontWeight:"500",padding:"0.25rem 0",display:"flex",alignItems:"center",gap:"0.375rem",transition:"color 0.2s"},onMouseEnter:t=>{t.currentTarget.style.color=w?"#dc2626":"#4338ca"},onMouseLeave:t=>{t.currentTarget.style.color=w?"#ef4444":"#4f46e5"},children:[e.jsx(B,{size:16}),w?"Cancel":"Reply"]}),m&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[!o.approved&&e.jsxs("button",{onClick:C,disabled:n,style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontSize:"13px",fontWeight:"500",opacity:n?.6:1,transition:"all 0.2s"},onMouseEnter:t=>{n||(t.currentTarget.style.background="#059669")},onMouseLeave:t=>{n||(t.currentTarget.style.background="#10b981")},children:[e.jsx(F,{size:14}),"Approve"]}),o.approved&&e.jsxs("button",{onClick:i,disabled:n,style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",background:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontSize:"13px",fontWeight:"500",opacity:n?.6:1,transition:"all 0.2s"},onMouseEnter:t=>{n||(t.currentTarget.style.background="#d97706")},onMouseLeave:t=>{n||(t.currentTarget.style.background="#f59e0b")},children:[e.jsx(A,{size:14}),"Unapprove"]}),e.jsxs("button",{onClick:f,disabled:n,style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontSize:"13px",fontWeight:"500",opacity:n?.6:1,transition:"all 0.2s"},onMouseEnter:t=>{n||(t.currentTarget.style.background="#dc2626")},onMouseLeave:t=>{n||(t.currentTarget.style.background="#ef4444")},children:[e.jsx(W,{size:14}),"Delete"]})]})]})]})]}),b&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("button",{type:"button",onClick:()=>y(!x),className:"view-replies-button",style:{background:"transparent",backgroundColor:"transparent",border:"none",color:"#4f46e5",cursor:"pointer",fontSize:"14px",fontWeight:"500",padding:"0.5rem 0.75rem",borderRadius:"6px",display:"flex",alignItems:"center",gap:"0.5rem",transition:"color 0.2s"},onMouseEnter:t=>{t.currentTarget.style.color="#4338ca"},onMouseLeave:t=>{t.currentTarget.style.color="#4f46e5"},children:[x?e.jsx(D,{size:16}):e.jsx($,{size:16}),e.jsxs("span",{children:[x?"Hide":"View"," ",o.replies?.length," ",o.replies?.length===1?"reply":"replies"]})]}),x&&e.jsx("ul",{className:"comment-replies",style:{listStyle:"none",padding:0,margin:"1rem 0 0 0"},children:o.replies?.map(t=>e.jsxs("li",{id:`comment-${t.id}`,children:[e.jsx(L,{comment:t,onReply:a,replyToId:d,depth:c+1,admin:m,onUpdated:s,articleId:h,maxDepth:g}),d===t.id&&a&&h&&e.jsx("div",{style:{marginTop:"1rem",marginLeft:"2rem"},children:e.jsx(E,{articleId:h,parentId:d,parentAuthorName:t.user?.name||t.authorName||"comment",onSubmitted:()=>{s&&s()},onCancel:()=>{a(null,"")}})})]},t.id))})]})]})}function O({articleId:o,showForm:a=!0,admin:d=!1}){const[c,m]=p.useState([]),[s,h]=p.useState(!0),[g,x]=p.useState(null),[y,b]=p.useState(null),[w,j]=p.useState(null),[n,u]=p.useState(0);p.useEffect(()=>{async function i(){try{h(!0),x(null);const f=d?`/api/comments?articleId=${o}&admin=true`:`/api/comments?articleId=${o}`,v=await fetch(f,{credentials:"include"});if(!v.ok){const T=await v.text();throw console.error("Failed to fetch comments:",v.status,T),new Error(`Failed to fetch comments: ${v.status}`)}const t=await v.json();m(Array.isArray(t)?t:[])}catch(f){console.error("Error fetching comments:",f),x(f instanceof Error?f.message:"Failed to load comments"),m([])}finally{h(!1)}}o?i():(console.warn("No articleId provided to CommentsList"),h(!1))},[o,n,d]);const r=(i,f)=>{i===null||y===i?(b(null),j(null)):(b(i),j(f))},l=()=>{b(null),j(null),u(i=>i+1)},S=()=>{u(i=>i+1)};if(s)return e.jsxs("div",{style:{padding:"3rem 0",textAlign:"center"},children:[e.jsx("div",{style:{display:"inline-block"},children:e.jsxs("svg",{className:"animate-spin",style:{width:"32px",height:"32px",color:"#4f46e5"},viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("p",{style:{marginTop:"1rem",color:"#6b7280",fontSize:"15px"},children:"Loading comments..."})]});if(g)return e.jsxs("div",{style:{padding:"2rem",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#ef4444",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:"#991b1b"},children:"Error loading comments"})]}),e.jsx("p",{style:{margin:0,color:"#b91c1c",fontSize:"14px"},children:g})]});const C=c.reduce((i,f)=>{const v=t=>!t||t.length===0?0:t.length+t.reduce((T,R)=>T+v(R.replies),0);return i+1+v(f.replies)},0);return e.jsxs("section",{className:"comments-section",style:{padding:"2rem 0"},children:[e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsxs("h2",{style:{fontSize:"24px",fontWeight:"700",color:"#111827",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{children:"Comments"}),c.length>0&&e.jsx("span",{style:{fontSize:"16px",fontWeight:"500",color:"#6b7280",background:"#f3f4f6",padding:"0.25rem 0.75rem",borderRadius:"12px"},children:C}),d&&e.jsx("span",{style:{fontSize:"14px",fontWeight:"400",color:"#6b7280"},children:"(including unapproved)"})]})}),a&&!y&&e.jsx("div",{style:{marginBottom:"2.5rem"},children:e.jsx(E,{articleId:o,parentId:null,onSubmitted:l,onCancel:void 0})}),c.length===0?e.jsxs("div",{style:{padding:"3rem 2rem",textAlign:"center",background:"linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%)",borderRadius:"12px",border:"2px dashed #e5e7eb"},children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",style:{margin:"0 auto 1rem",color:"#9ca3af"},children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("p",{style:{color:"#374151",fontSize:"16px",fontWeight:"500",margin:"0 0 0.5rem 0"},children:d?"No comments yet":"No comments yet. Be the first to comment!"}),!d&&e.jsx("p",{style:{color:"#6b7280",fontSize:"14px",margin:0},children:"Start the conversation by sharing your thoughts below."})]}):e.jsx("div",{className:"comments-list",children:c.map(i=>e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx(L,{comment:i,onReply:r,replyToId:y,admin:d,onUpdated:S,articleId:o}),y===i.id&&e.jsx("div",{style:{marginTop:"1rem",marginLeft:"3rem"},children:e.jsx(E,{articleId:o,parentId:y,parentAuthorName:w,onSubmitted:l,onCancel:()=>{b(null),j(null)}})})]},i.id))})]})}export{O as default};
