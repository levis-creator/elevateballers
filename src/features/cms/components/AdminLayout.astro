---
import Layout from '../../../layouts/Layout.astro';
import { checkAuth } from '../../cms/lib/auth-astro';
import AdminSidebar from './AdminSidebar';
import '../../../styles/admin.css';

interface Props {
  title?: string;
}

const { title = 'Admin - Elevate Ballers CMS' } = Astro.props;

// Check authentication
const user = await checkAuth(Astro.request);

// Redirect to login if not authenticated
if (!user) {
  return Astro.redirect('/admin/login', 302);
}
---

<Layout title={title}>
  <div class="flex min-h-screen bg-[#f9fafb] relative w-full font-sans">
    <!-- Sidebar Navigation -->
    <AdminSidebar client:load />

    <!-- Main Content Area -->
    <main class="flex-1 ml-[260px] min-h-screen w-[calc(100%-260px)] md:ml-[260px] md:w-[calc(100%-260px)] max-md:ml-0 max-md:w-full">
      <div class="p-8 max-w-[1400px] mx-auto w-full max-md:p-4 max-[480px]:p-3 admin-page scroll-smooth">
        <slot />
      </div>
    </main>
  </div>

  <style is:global>
    /* Design System Variables - Kept for backward compatibility */
    :root {
      --admin-primary: #dd3333;
      --admin-primary-dark: #c02a2a;
      --admin-gray-50: #f9fafb;
      --admin-gray-100: #f3f4f6;
      --admin-gray-200: #e5e7eb;
      --admin-gray-300: #d1d5db;
      --admin-gray-500: #6b7280;
      --admin-gray-700: #374151;
      --admin-gray-900: #111827;
      --admin-success: #10b981;
      --admin-error: #ef4444;
    }

    /* Override any conflicting styles from main Layout */
    body.admin-page,
    html.admin-page {
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Typography - Preserve heading font */
    .admin-page h1, .admin-page h2, .admin-page h3 {
      font-family: 'Teko', sans-serif;
      font-weight: 600;
      line-height: 1.2;
    }
    
    /* Smooth Scrolling */
    .admin-page {
      scroll-behavior: smooth;
    }
  </style>
</Layout>
